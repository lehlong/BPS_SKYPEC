@model List<SMO.Models.RevenueReportModel>
@using System.Text;
@using Newtonsoft.Json;
@using Newtonsoft.Json.Serialization;
@{
    var year = ViewBag.Year as int?;
    var gridId = Guid.NewGuid().ToString("N");
    var jsonSerializeSettings = new JsonSerializerSettings { ContractResolver = new CamelCasePropertyNamesContractResolver() };
    var jsonData = Model.OrderBy(x => x.Order).Select(x => new
    {
        Id = x.Order.ToString(),
        Parent = x.Parent,
        Name = x.Name,
        SumYear = x.ValueSumYear.ToStringVN(),
        Jan = x.Value1.ToStringVN(),
        Feb = x.Value2.ToStringVN(),
        Mar = x.Value3.ToStringVN(),
        Apr = x.Value4.ToStringVN(),
        May = x.Value5.ToStringVN(),
        Jun = x.Value6.ToStringVN(),
        Jul = x.Value7.ToStringVN(),
        Aug = x.Value8.ToStringVN(),
        Sep = x.Value9.ToStringVN(),
        Oct = x.Value10.ToStringVN(),
        Nov = x.Value11.ToStringVN(),
        Dec = x.Value12.ToStringVN(),
        IsBold = x.IsBold
    });
}
<style>
    .row-bold .dhx_grid-cell,.row-bold .dhx_tree-cell {
        font-weight: bold
    }
    .grid .dhx_grid-cell {
        word-break: break-word
    }
</style>

<div id="slider" style="width: 200px"></div>
<div style="height: calc(100vh - 240px); width: 100%" id="@gridId"></div>

<script type="text/javascript">
    const rawData = @Html.Raw(JsonConvert.SerializeObject(jsonData, jsonSerializeSettings));


    const MAIN_FONT_SIZE = 14;
    let columns = [
        { id: "name", header: [{ text: "CHỈ TIÊU", align: "center" }, { content: "inputFilter" }], minWidth: 300 },
        { id: "sumYear", header: [{ text: "TỔNG NĂM", align: "center" }], align: "right", minWidth: 180 },
        { id: "jan", header: [{ text: "THÁNG 1", align: "center" }], align: "right", minWidth: 180 },
        { id: "feb", header: [{ text: "THÁNG 2", align: "center" }], align: "right", minWidth: 180 },
        { id: "mar", header: [{ text: "THÁNG 3", align: "center" }], align: "right", minWidth: 180 },
        { id: "apr", header: [{ text: "THÁNG 4", align: "center" }], align: "right", minWidth: 180 },
        { id: "may", header: [{ text: "THÁNG 5", align: "center" }], align: "right", minWidth: 180 },
        { id: "jun", header: [{ text: "THÁNG 6", align: "center" }], align: "right", minWidth: 180 },
        { id: "jul", header: [{ text: "THÁNG 7", align: "center" }], align: "right", minWidth: 180 },
        { id: "aug", header: [{ text: "THÁNG 8", align: "center" }], align: "right", minWidth: 180 },
        { id: "sep", header: [{ text: "THÁNG 9", align: "center" }], align: "right", minWidth: 180 },
        { id: "oct", header: [{ text: "THÁNG 10", align: "center" }], align: "right", minWidth: 180 },
        { id: "nov", header: [{ text: "THÁNG 11", align: "center" }], align: "right", minWidth: 180 },
        { id: "dec", header: [{ text: "THÁNG 12", align: "center" }], align: "right", minWidth: 180 },
    ];
    const widthMap = new Map(columns.map(({ minWidth, id }) => ([id, minWidth])));
    rawData.forEach((item) => {
        if (item.parent == null) {
            delete item.parent
        }
    });
    const treeGrid = new dhx.TreeGrid("@gridId", {
        columns,
        data: rawData,
        leftSplit: 1,
        resizable: true,
        keyNavigation: true,
        rowCss: function ({ isBold }) { return isBold == true ? "row-bold" : "" },
        selection: true,
        autoHeight: true,
    });

    const slider = new dhx.Slider("slider", {
        min: 4,
        max: 36,
        step: 1,
        value: MAIN_FONT_SIZE,
        tooltip: false
    });

    slider.events.on("change", value => {
        const fontSize = parseInt(value);
        document.documentElement.style.setProperty("--dhx-font-size-normal", fontSize + "px");

        columns = columns.map(column => {
            return {
                ...column,
                minWidth: widthMap.get(column.id) * (fontSize / MAIN_FONT_SIZE) - 2,
            };
        });
        $(".dhx_grid-cell").css("font-size", `${value}px`);
        $(".dhx_tree-cell").css("font-size", `${value}px`);
        $(".dhx_grid-header-cell").css("font-size", `${value}px`);
        treeGrid.setColumns(columns);
    });


</script>

